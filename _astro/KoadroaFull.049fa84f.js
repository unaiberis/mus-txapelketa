import{S as x,b as B,a as N,e as I,d as D,f as L,h as y,k as w,l as O,m as V,n as b,H as q,I as R,B as J,Q as k,_ as v}from"./bracketryUtils.0053be32.js";/* empty css                         */function j(h){let i,s;return{c(){i=I("div"),s=I("div"),this.h()},l(t){i=D(t,"DIV",{class:!0});var l=L(i);s=D(l,"DIV",{id:!0,class:!0}),L(s).forEach(y),l.forEach(y),this.h()},h(){w(s,"id","brackets-viewer-wrapper"),w(s,"class","svelte-p3yaa4"),w(i,"class","koadroa-full svelte-p3yaa4")},m(t,l){O(t,i,l),V(i,s),h[1](s)},p:b,i:b,o:b,d(t){t&&y(i),h[1](null)}}}function z(h,i,s){let t=null,l=null,d=null;async function f(r,e){try{const{createBracket:a}=await v(()=>import("./index.59f06f24.js"),[]);return window.__advanceMatch=(c,o)=>S(c,o),a(r,e,{onMatchSideClick:(c,o)=>{window.__advanceMatch?.(c.matchId,o+1)}}),!0}catch(a){console.error("safeCreateBracket failed",a);try{e.innerHTML='<div class="render-error p-2 rounded bg-red-50 border border-red-200"><strong>Error rendering bracket:</strong> '+(a?.message||String(a))+"</div>"}catch{e.textContent=JSON.stringify(r)}return!1}}function g(){!l||!d||t&&(t.querySelectorAll(".participant").forEach(r=>r.replaceWith(r.cloneNode(!0))),t.querySelectorAll("[data-match-id]").forEach(r=>{const e=Number(r.getAttribute("data-match-id"));r.querySelectorAll(".participant").forEach((c,o)=>{c.addEventListener("click",async p=>{p.stopPropagation(),await S(e,o+1)})})}))}async function S(r,e){if(!l||!d){console.warn("Manager not available");return}try{const a={id:r};e===1?(a.opponent1={score:1,result:"win"},a.opponent2={score:0}):(a.opponent1={score:0},a.opponent2={score:1,result:"win"}),await l.update.match(a);const c=d.data.stage||[],o=d.data.match||[],p=d.data.participant||[];if(lastManagerData={stages:c,matches:o,participants:p,matchGames:d.data.match_game||[]},t){const _=k(o,p);s(0,t.innerHTML="",t),s(0,t.style.height="100%",t),await f(_,t)&&g()}}catch(a){console.error("Could not update match",a)}}q(async()=>{if(!t)return;s(0,t.innerHTML="",t),s(0,t.style.height="100%",t);const r=localStorage.getItem("randomStageData");if(r)try{const e=JSON.parse(r),a=e.matches||[],c=e.participants||[],o=k(a,c);await f(o,t),g();return}catch(e){console.warn("Could not parse randomStageData",e)}try{const e=localStorage.getItem("mus:pairs"),a=e?JSON.parse(e):[];if(!a||a.length===0){s(0,t.innerHTML='<div class="p-4 text-center text-gray-500">No hay parejas para mostrar el cuadro.</div>',t);return}const o=a.map((n,u)=>n&&typeof n=="object"&&"a"in n&&"b"in n?`${n.a} / ${n.b} #${u+1}`:Array.isArray(n)&&n[0]&&n[1]?`${n[0].name||n[0]} / ${n[1].name||n[1]} #${u+1}`:`Pair ${u+1}`),_=(n=>{let u=1;for(;u<n;)u<<=1;return u})(o.length),{BracketsManager:E}=await v(()=>import("./index.42f7075a.js").then(n=>n.i),[]),{default:A}=await v(()=>import("./inMemoryStorage.942a0156.js"),[]),m=new A,M=new E(m);await M.create({tournamentId:0,name:"Stage",type:"single_elimination",seeding:o,settings:{size:_}}),d=m,l=M;const P=m.data.match||[],T=m.data.participant||[],H=k(P,T);await f(H,t),g()}catch(e){console.error("Could not build ephemeral stage for full-screen",e),s(0,t.innerHTML='<div class="render-error p-4">Error building stage: '+(e?.message||String(e))+"</div>",t)}}),R(()=>{try{t&&s(0,t.innerHTML="",t)}catch{}});function C(r){J[r?"unshift":"push"](()=>{t=r,s(0,t)})}return[t,C]}class K extends x{constructor(i){super(),B(this,i,z,j,N,{})}}export{K as default};
